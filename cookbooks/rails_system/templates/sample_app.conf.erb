upstream unicorn_sample_sock{
  ip_hash;
  server unix:/vagrant/tmp/sockets/unicorn.sock fail_timeout=0;
}

server{
  # server_name test.mokoaki.net;
  # server_name hoge.mokoaki.net;
  listen      80;
  root        /vagrant/public;

  access_log /vagrant/log/nginx_access_sample.log;
  error_log  /vagrant/log/nginx_error_sample.log  warn;

  #タイムアウト
  proxy_connect_timeout 75;
  proxy_read_timeout    90;
  proxy_send_timeout    60;

  #バッファサイズの設定
  proxy_buffering   on;
  proxy_buffer_size 8k;
  proxy_buffers 128 8k;

  location / {
    # 静的ファイルが存在しなかった時はUnicornにproxy
    if (!-f $request_filename){
      break;
    }

    proxy_set_header Host $http_host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header Client-IP $remote_addr;
    proxy_set_header X-Forwarded-For $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

    proxy_redirect   off;
    proxy_pass       http://unicorn_sample_sock;
  }

  # この設定はdevelopでは使わない方が？
  # location ~ ^/assets/ {
  # location /assets {
  #   alias /vagrant/app/assets;
  #   #root /vagrant/app/assets;
  # }

  # location ~* \.(ico|css|js|gif|jpe?g|png)(\?[0-9]+)?$ {
  #   expires 1y;
  # }
}
